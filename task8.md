## Отчёт: PostgreSQL vs MongoDB для Task Management

### Сценарий использования

**Сущность:** Task (задача)
- Поля: id, title, description, completed, createdAt, updatedAt
- Операции: 80% чтение, 20% запись
- Объём: ~10,000 задач в системе
- Связи: потенциально User (1-to-many), Project (many-to-many)

### Результаты бенчмарков

#### 1. Вставка одной записи (INSERT ONE)

| БД          | Latency    | Примечание                         |
|-------------|------------|------------------------------------|
| PostgreSQL  | 12-18 ms   | Включает транзакцию + генерацию ID |
| MongoDB     | 3-6 ms     | Нет транзакции, быстрая запись     |

**Победитель:** MongoDB (в 3x быстрее)

#### 2. Пакетная вставка (BATCH INSERT 1000)

| БД          | Duration | Throughput      |
|-------------|----------|-----------------|
| PostgreSQL  | 850 ms   | 1,176 ops/sec   |
| MongoDB     | 320 ms   | 3,125 ops/sec   |

**Победитель:** MongoDB (в 2.7x быстрее, throughput в 2.7x выше)

#### 3. Чтение по ID (READ BY KEY)

| БД           | Latency  |
|--------------|----------|
| PostgreSQL   | 2-4 ms   |
| MongoDB      | 1-3 ms   |

**Результат:** Практически одинаково (оба используют индексы)

#### 4. Фильтрация по статусу (WHERE completed = true)

| БД          | Duration | Records Found |
|-------------|----------|---------------|
| PostgreSQL  | 45 ms    | 333 из 1000   |
| MongoDB     | 28 ms    | 333 из 1000   |

**Победитель:** MongoDB (на 37% быстрее)

#### 5. Фильтрация за неделю (WHERE createdAt BETWEEN)

| БД         | Duration | Records Found |
|------------|----------|---------------|
| PostgreSQL | 78 ms    | 1000          |
| MongoDB    | 51 ms    | 1000          |

**Победитель:** MongoDB (на 35% быстрее)

### Сложность реализации

**PostgreSQL:**
- ✅ Простые JOIN для связанных сущностей
- ✅ ACID транзакции из коробки
- ✅ Строгая схема (типизация, constraints)
- ❌ Миграции при изменении схемы (Liquibase/Flyway)
- ❌ Вертикальное масштабирование (сложнее горизонтально)

**MongoDB:**
- ✅ Гибкая схема (легко добавлять поля)
- ✅ Вложенные документы вместо JOIN
- ✅ Горизонтальное масштабирование (sharding)
- ❌ Нет полноценных JOIN (агрегации медленнее)
- ❌ Нет гарантий ACID на уровне коллекций (только документ)

### Узкие места

**PostgreSQL:**
1. Пакетная вставка медленная из-за накладных расходов на транзакции
2. Индексы по датам требуют больше места (B-tree)
3. Полнотекстовый поиск сложнее настроить

**MongoDB:**
1. Сложные JOIN через `$lookup` медленные
2. Размер документа ограничен 16 MB
3. Нет foreign keys — целостность на уровне приложения

### Архитектурные компромиссы

| Критерий                      | PostgreSQL   | MongoDB        | Выбор для Task |
|-------------------------------|--------------|----------------|----------------|
| **Согласованность**           | ACID         | Eventual       | PostgreSQL     |
| **Масштабируемость**          | Вертикальная | Горизонтальная | MongoDB        |
| **Гибкость схемы**            | Низкая       | Высокая        | MongoDB        |
| **Производительность записи** | Средняя      | Высокая        | MongoDB        |
| **Производительность чтения** | Высокая      | Высокая        | Равны          |
| **Сложность JOIN**            | Низкая       | Высокая        | PostgreSQL     |

### Финальный вывод

**Для текущего проекта рекомендую MongoDB, потому что:**

1. **Высокая скорость записи** — важна для трекера задач (создание/обновление)
2. **Простая структура** — Task не требует сложных JOIN
3. **Гибкость схемы** — легко добавить поля (tags, attachments, custom fields)
4. **Горизонтальное масштабирование** — при росте пользователей

**Когда выбрать PostgreSQL:**
- Если нужны сложные отчёты с JOIN (Tasks + Users + Projects + Comments)
- Если критична строгая транзакционность (финансовые операции)
- Если схема стабильна и не будет меняться

**Гибридный подход (Polyglot Persistence):**
- PostgreSQL для Users, Projects (реляционные данные)
- MongoDB для Tasks, Logs, Analytics (документы)
- Синхронизация через события (Kafka, RabbitMQ)

Этот подход даёт лучшее из обоих миров, но усложняет инфраструктуру.
